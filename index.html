<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Citizenship Practice Test â€” Ultimate Edition</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="questions.js"></script>
  <style>
    :root {
      --bg-dark: #050505;
      --card-bg: rgba(20, 20, 25, 0.6);
      --card-border: rgba(255, 255, 255, 0.08);
      --primary: #6366f1;
      --primary-glow: rgba(99, 102, 241, 0.5);
      --secondary: #06b6d4;
      --secondary-glow: rgba(6, 182, 212, 0.5);
      --accent: #f43f5e;
      --success: #10b981;
      --success-glow: rgba(16, 185, 129, 0.4);
      --text-main: #ffffff;
      --text-muted: #94a3b8;
      --font-main: 'Outfit', sans-serif;
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-main);
      font-family: var(--font-main);
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated Background */
    .bg-mesh {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background:
        radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.15), transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(6, 182, 212, 0.15), transparent 25%);
      filter: blur(60px);
      animation: pulse-bg 10s ease-in-out infinite alternate;
    }

    @keyframes pulse-bg {
      0% {
        opacity: 0.8;
        transform: scale(1);
      }

      100% {
        opacity: 1;
        transform: scale(1.1);
      }
    }

    .page {
      max-width: 1280px;
      margin: 0 auto;
      padding: 40px 24px 100px;
      position: relative;
    }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 32px;
      align-items: start;
    }

    /* Hero Section */
    header.hero {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--card-border);
      border-radius: 32px;
      padding: 40px;
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(20px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    header.hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--secondary), transparent);
      opacity: 0.5;
    }

    .eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--secondary);
      background: rgba(6, 182, 212, 0.1);
      padding: 6px 12px;
      border-radius: 100px;
      margin-bottom: 16px;
      border: 1px solid rgba(6, 182, 212, 0.2);
      box-shadow: 0 0 20px rgba(6, 182, 212, 0.2);
    }

    h1 {
      font-size: clamp(32px, 5vw, 56px);
      font-weight: 800;
      margin: 0 0 16px;
      line-height: 1.1;
      background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.02em;
    }

    .intro {
      font-size: 18px;
      color: var(--text-muted);
      max-width: 600px;
      line-height: 1.6;
      margin: 0 0 32px;
    }

    /* Buttons */
    .btn {
      appearance: none;
      border: none;
      background: none;
      font-family: inherit;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      padding: 14px 28px;
      border-radius: 16px;
      transition: all 0.3s var(--ease-elastic);
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn.primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 8px 20px var(--primary-glow);
    }

    .btn.primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 30px var(--primary-glow);
    }

    .btn.secondary {
      background: rgba(255, 255, 255, 0.05);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn.secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }

    /* Stats Row in Hero */
    .stat-row {
      display: flex;
      gap: 24px;
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-row span {
      font-size: 14px;
      color: var(--text-muted);
    }

    .stat-row strong {
      color: white;
      font-weight: 700;
      margin-left: 4px;
    }

    /* Toolbar */
    .toolbar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .tool-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 24px;
      padding: 24px;
      backdrop-filter: blur(12px);
    }

    .tool-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      font-weight: 700;
      margin-bottom: 12px;
    }

    /* Inputs */
    .filter-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    input[type="search"],
    select {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
      flex: 1;
      min-width: 140px;
    }

    input[type="search"]:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      background: rgba(0, 0, 0, 0.4);
    }

    select option {
      background: #0f172a;
      color: white;
    }

    /* Question Grid */
    .question-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 24px;
    }

    .question-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 24px;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      transition: all 0.4s var(--ease-elastic);
      position: relative;
      backdrop-filter: blur(10px);
    }

    .question-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 255, 255, 0.2);
      z-index: 2;
    }

    .question-card.correct {
      border-color: var(--success);
      box-shadow: 0 0 30px var(--success-glow);
    }

    .question-card.incorrect {
      border-color: var(--accent);
      box-shadow: 0 0 30px rgba(244, 63, 94, 0.3);
    }

    .q-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
    }

    .q-badge {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .q-text {
      font-size: 16px;
      line-height: 1.5;
      font-weight: 500;
      color: #f1f5f9;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option-btn {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 14px 16px;
      border-radius: 14px;
      color: var(--text-muted);
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 14px;
      line-height: 1.4;
      position: relative;
      overflow: hidden;
    }

    .option-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: white;
      transform: translateX(4px);
    }

    .option-marker {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .option-btn:hover .option-marker {
      border-color: white;
      color: white;
    }

    /* States */
    .option-btn.picked {
      background: rgba(99, 102, 241, 0.15);
      border-color: var(--primary);
      color: white;
    }

    .option-btn.picked .option-marker {
      background: var(--primary);
      border-color: var(--primary);
    }

    .option-btn.correct {
      background: rgba(16, 185, 129, 0.15);
      border-color: var(--success);
      color: white;
    }

    .option-btn.correct .option-marker {
      background: var(--success);
      border-color: var(--success);
      color: #000;
    }

    .option-btn.wrong {
      background: rgba(244, 63, 94, 0.15);
      border-color: var(--accent);
      color: white;
    }

    .option-btn.wrong .option-marker {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Dashboard Sidebar */
    .dashboard {
      position: sticky;
      top: 40px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 24px;
      padding: 24px;
      backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .dash-header {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 700;
      color: var(--secondary);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 16px;
    }

    .dash-stat {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .dash-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .dash-val {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .dash-val.good {
      color: var(--success);
      text-shadow: 0 0 20px var(--success-glow);
    }

    .dash-val.bad {
      color: var(--accent);
      text-shadow: 0 0 20px rgba(244, 63, 94, 0.4);
    }

    .progress-track {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 100px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      width: 0%;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 12px var(--primary-glow);
    }

    /* Mobile Bar */
    .mobile-bar {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(16px);
      padding: 16px 20px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }

    .mobile-stats {
      font-size: 13px;
      font-weight: 600;
      color: white;
    }

    .mobile-stats span {
      color: var(--text-muted);
      font-weight: 400;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 200;
      display: none;
      place-items: center;
      padding: 20px;
      animation: fade-in 0.2s ease;
    }

    .modal {
      background: #1e1e24;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      width: 100%;
      max-width: 600px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      animation: slide-up 0.3s var(--ease-elastic);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 700;
      font-size: 18px;
    }

    .modal-grid {
      padding: 24px;
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 8px;
    }

    .grid-item {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .grid-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }

    .grid-item.correct {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border-color: rgba(16, 185, 129, 0.3);
    }

    .grid-item.incorrect {
      background: rgba(244, 63, 94, 0.2);
      color: var(--accent);
      border-color: rgba(244, 63, 94, 0.3);
    }

    @keyframes fade-in {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slide-up {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 var(--secondary-glow);
      }

      70% {
        box-shadow: 0 0 0 15px transparent;
      }

      100% {
        box-shadow: 0 0 0 0 transparent;
      }
    }

    .pulse-anim {
      animation: pulse 1s infinite;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .dashboard {
        display: none;
      }

      .mobile-bar {
        display: flex;
      }
    }

    @media (max-width: 640px) {
      .hero {
        padding: 24px;
      }

      h1 {
        font-size: 32px;
      }

      .stat-row {
        flex-direction: column;
        gap: 8px;
      }

      .question-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="bg-mesh"></div>

  <div class="page">
    <div class="layout">
      <main>
        <header class="hero">
          <div class="eyebrow">
            <span style="font-size: 16px;">ðŸ‡¨ðŸ‡¦</span> Citizenship Practice
          </div>
          <h1>Master Your Test</h1>
          <p class="intro">
            Interactive practice with instant feedback. Track your progress, filter by province, and master every
            question.
          </p>

          <div class="hero-actions">
            <button class="btn primary" id="reset-btn">Reset Progress</button>
            <button class="btn secondary" id="jump-unanswered">Jump to Next</button>

            <div class="stat-row" id="live-stats">
              <span>Answered: <strong id="answered-count">0</strong>/<span id="total-count">0</span></span>
              <span>Correct: <strong id="correct-count" style="color: var(--success)">0</strong></span>
              <span>Wrong: <strong id="incorrect-count" style="color: var(--accent)">0</strong></span>
            </div>
          </div>
        </header>

        <div class="toolbar">
          <div class="tool-card">
            <div class="tool-label">Your Progress</div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;">
              <div style="font-size: 32px; font-weight: 800;" id="progress-percent">0%</div>
              <div style="color: var(--text-muted); font-size: 13px;">Completed</div>
            </div>
            <div class="progress-track">
              <div class="progress-fill" id="progress-bar"></div>
            </div>
          </div>

          <div class="tool-card">
            <div class="tool-label">Filter Questions</div>
            <div class="filter-group">
              <input type="search" id="search" placeholder="Search keywords or Q#...">
              <select id="status-filter">
                <option value="all">All Status</option>
                <option value="unanswered">Unanswered</option>
                <option value="correct">Correct</option>
                <option value="incorrect">Incorrect</option>
              </select>
              <select id="province-filter">
                <option value="all">All Provinces</option>
                <option value="Quebec">Quebec</option>
                <option value="Alberta">Alberta</option>
                <option value="British Columbia">British Columbia</option>
                <option value="Manitoba">Manitoba</option>
                <option value="New Brunswick">New Brunswick</option>
                <option value="Newfoundland and Labrador">Newfoundland & Labrador</option>
                <option value="Nova Scotia">Nova Scotia</option>
                <option value="Northwest Territories">NWT</option>
                <option value="Nunavut">Nunavut</option>
                <option value="Ontario">Ontario</option>
                <option value="Prince Edward Island">PEI</option>
                <option value="Saskatchewan">Saskatchewan</option>
                <option value="Yukon">Yukon</option>
              </select>
              <button class="btn secondary" id="clear-filters" style="padding: 12px;">Clear</button>
            </div>
          </div>
        </div>

        <section id="question-grid" class="question-grid"></section>
      </main>

      <aside class="dashboard">
        <div class="dash-header">Live Dashboard</div>

        <div class="dash-stat">
          <div class="dash-label">Questions Answered</div>
          <div class="dash-val"><span id="dash-answered">0</span><span
              style="font-size: 16px; color: var(--text-muted); font-weight: 500;"> / <span
                id="dash-total">0</span></span></div>
        </div>

        <div class="dash-stat">
          <div class="dash-label">Correct Answers</div>
          <div class="dash-val good" id="dash-correct">0</div>
        </div>

        <div class="dash-stat">
          <div class="dash-label">Incorrect Answers</div>
          <div class="dash-val bad" id="dash-incorrect">0</div>
        </div>

        <div class="dash-stat">
          <div class="dash-label">Completion</div>
          <div class="dash-val" id="dash-percent">0%</div>
          <div class="progress-track">
            <div class="progress-fill" id="dash-progress-bar"></div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="mobile-bar">
    <div class="mobile-stats">
      <span id="mb-percent">0%</span> Done &bull; <span style="color: var(--success)" id="mb-correct">0</span> / <span
        style="color: var(--accent)" id="mb-incorrect">0</span>
    </div>
    <button class="btn secondary" id="open-overview" style="padding: 8px 16px; font-size: 12px;">View Grid</button>
  </div>

  <div class="modal-backdrop" id="overview-modal">
    <div class="modal">
      <div class="modal-header">
        <div>Question Overview</div>
        <button class="btn secondary" id="close-overview" style="padding: 8px 16px; font-size: 12px;">Close</button>
      </div>
      <div class="modal-grid" id="overview-list"></div>
    </div>
  </div>

  <script>
    // State
    const state = [];
    let correctCount = 0;
    let incorrectCount = 0;

    // Elements
    const grid = document.getElementById('question-grid');
    const els = {
      answered: document.getElementById('answered-count'),
      total: document.getElementById('total-count'),
      correct: document.getElementById('correct-count'),
      incorrect: document.getElementById('incorrect-count'),
      percent: document.getElementById('progress-percent'),
      bar: document.getElementById('progress-bar'),
      search: document.getElementById('search'),
      status: document.getElementById('status-filter'),
      province: document.getElementById('province-filter'),
      dashAnswered: document.getElementById('dash-answered'),
      dashTotal: document.getElementById('dash-total'),
      dashCorrect: document.getElementById('dash-correct'),
      dashIncorrect: document.getElementById('dash-incorrect'),
      dashPercent: document.getElementById('dash-percent'),
      dashBar: document.getElementById('dash-progress-bar'),
      mbPercent: document.getElementById('mb-percent'),
      mbCorrect: document.getElementById('mb-correct'),
      mbIncorrect: document.getElementById('mb-incorrect'),
      modal: document.getElementById('overview-modal'),
      list: document.getElementById('overview-list')
    };

    // Province Data
    const PROVINCE_BY_QNUM = {
      147: 'Quebec', 148: 'Quebec', 149: 'Alberta', 150: 'Alberta', 151: 'Alberta', 152: 'Alberta', 153: 'Alberta', 154: 'Alberta',
      155: 'British Columbia', 156: 'British Columbia', 157: 'British Columbia', 158: 'British Columbia', 159: 'British Columbia', 160: 'British Columbia', 161: 'British Columbia', 162: 'British Columbia', 163: 'British Columbia', 164: 'British Columbia', 165: 'British Columbia', 166: 'British Columbia',
      167: 'Manitoba', 168: 'Manitoba', 169: 'Manitoba', 170: 'Manitoba', 171: 'Manitoba', 172: 'Manitoba',
      173: 'New Brunswick', 174: 'New Brunswick', 175: 'New Brunswick', 176: 'New Brunswick', 177: 'New Brunswick', 178: 'New Brunswick',
      179: 'Newfoundland and Labrador', 180: 'Newfoundland and Labrador', 181: 'Newfoundland and Labrador', 182: 'Newfoundland and Labrador', 183: 'Newfoundland and Labrador', 184: 'Newfoundland and Labrador',
      185: 'Nova Scotia', 186: 'Nova Scotia', 187: 'Nova Scotia', 188: 'Nova Scotia', 189: 'Nova Scotia', 190: 'Nova Scotia',
      191: 'Northwest Territories', 192: 'Northwest Territories', 193: 'Northwest Territories', 194: 'Northwest Territories', 195: 'Northwest Territories',
      196: 'Nunavut', 197: 'Nunavut', 198: 'Nunavut', 199: 'Nunavut', 200: 'Nunavut',
      201: 'Ontario', 202: 'Ontario', 203: 'Ontario', 204: 'Ontario', 205: 'Ontario', 206: 'Ontario',
      207: 'Prince Edward Island', 208: 'Prince Edward Island', 209: 'Prince Edward Island', 210: 'Prince Edward Island', 211: 'Prince Edward Island',
      212: 'Quebec', 213: 'Quebec', 214: 'Quebec', 215: 'Quebec',
      216: 'Saskatchewan', 217: 'Saskatchewan', 218: 'Saskatchewan', 219: 'Saskatchewan', 220: 'Saskatchewan', 221: 'Saskatchewan',
      222: 'Yukon', 223: 'Yukon', 224: 'Yukon', 225: 'Yukon', 226: 'Yukon'
    };
    const CORE_INDICES = QUESTIONS.map((_, idx) => idx).filter(idx => !PROVINCE_BY_QNUM[idx + 1]);

    // Init
    function init() {
      QUESTIONS.forEach((q, i) => {
        state[i] = { choice: null, status: 'unanswered' };
        createCard(q, i);
      });
      updateStats();

      // Listeners
      document.getElementById('reset-btn').addEventListener('click', resetAll);
      document.getElementById('jump-unanswered').addEventListener('click', jumpNext);
      document.getElementById('clear-filters').addEventListener('click', clearFilters);
      document.getElementById('open-overview').addEventListener('click', () => { els.modal.style.display = 'grid'; renderOverview(); });
      document.getElementById('close-overview').addEventListener('click', () => els.modal.style.display = 'none');
      els.search.addEventListener('input', filterGrid);
      els.status.addEventListener('change', filterGrid);
      els.province.addEventListener('change', () => { filterGrid(); updateStats(); });
    }

    function createCard(q, index) {
      const card = document.createElement('article');
      card.className = 'question-card';
      card.dataset.index = index;
      card.dataset.status = 'unanswered';
      card.dataset.province = PROVINCE_BY_QNUM[index + 1] || '';

      const qText = q.question.replace(/^\\d+\\.\\s*/, '').trim();

      card.innerHTML = `
        <div class="q-header">
          <div class="q-badge">Q${index + 1}</div>
          <div class="q-badge status-badge">Unanswered</div>
        </div>
        <div class="q-text">${qText}</div>
        <div class="options">
          ${q.options.map((opt, i) => `
            <button class="option-btn" onclick="handleAnswer(${index}, ${i}, this)">
              <div class="option-marker">${String.fromCharCode(65 + i)}</div>
              <span>${opt}</span>
            </button>
          `).join('')}
        </div>
      `;
      grid.appendChild(card);
    }

    window.handleAnswer = (idx, choice, btn) => {
      const card = grid.children[idx];
      const q = QUESTIONS[idx];
      const st = state[idx];

      // Update State
      const wasCorrect = st.status === 'correct';
      const wasIncorrect = st.status === 'incorrect';
      const isCorrect = choice === q.answer;

      st.choice = choice;
      st.status = isCorrect ? 'correct' : 'incorrect';

      // Update Counts
      if (wasCorrect) correctCount--;
      if (wasIncorrect) incorrectCount--;
      if (isCorrect) correctCount++; else incorrectCount++;

      // Update UI
      card.className = `question-card ${st.status}`;
      card.dataset.status = st.status;
      card.querySelector('.status-badge').textContent = st.status === 'correct' ? 'Correct' : 'Incorrect';
      card.querySelector('.status-badge').style.color = st.status === 'correct' ? 'var(--success)' : 'var(--accent)';

      const opts = card.querySelectorAll('.option-btn');
      opts.forEach((b, i) => {
        b.className = 'option-btn';
        if (i === choice) b.classList.add('picked');
        if (i === q.answer) b.classList.add('correct');
        else if (i === choice) b.classList.add('wrong');
      });

      updateStats();
    };

    function updateStats() {
      const active = getActiveIndices();
      let c = 0, w = 0;

      active.forEach(i => {
        if (state[i].status === 'correct') c++;
        if (state[i].status === 'incorrect') w++;
      });

      const total = active.length;
      const ans = c + w;
      const pct = total ? Math.round((ans / total) * 100) : 0;

      // Update Text
      els.answered.textContent = ans;
      els.total.textContent = total;
      els.correct.textContent = c;
      els.incorrect.textContent = w;
      els.percent.textContent = `${pct}%`;
      els.bar.style.width = `${pct}%`;

      // Dash
      els.dashAnswered.textContent = ans;
      els.dashTotal.textContent = total;
      els.dashCorrect.textContent = c;
      els.dashIncorrect.textContent = w;
      els.dashPercent.textContent = `${pct}%`;
      els.dashBar.style.width = `${pct}%`;

      // Mobile
      els.mbPercent.textContent = `${pct}%`;
      els.mbCorrect.textContent = c;
      els.mbIncorrect.textContent = w;
    }

    function getActiveIndices() {
      const prov = els.province.value;
      if (prov === 'all') return QUESTIONS.map((_, i) => i);
      return QUESTIONS.map((_, i) => i).filter(i => {
        const p = PROVINCE_BY_QNUM[i + 1];
        return !p || p === prov; // Core + Province specific
      });
    }

    function filterGrid() {
      const term = els.search.value.toLowerCase();
      const stat = els.status.value;
      const prov = els.province.value;

      Array.from(grid.children).forEach(card => {
        const idx = parseInt(card.dataset.index);
        const q = QUESTIONS[idx];
        const p = PROVINCE_BY_QNUM[idx + 1];

        const matchSearch = term === '' || q.question.toLowerCase().includes(term) || String(idx + 1).includes(term);
        const matchStatus = stat === 'all' || card.dataset.status === stat;
        const matchProv = prov === 'all' || !p || p === prov;

        card.classList.toggle('hidden', !(matchSearch && matchStatus && matchProv));
      });
    }

    function resetAll() {
      if (!confirm('Reset all progress?')) return;
      state.forEach(s => { s.choice = null; s.status = 'unanswered'; });
      correctCount = 0; incorrectCount = 0;

      Array.from(grid.children).forEach(card => {
        card.className = 'question-card';
        card.dataset.status = 'unanswered';
        card.querySelector('.status-badge').textContent = 'Unanswered';
        card.querySelector('.status-badge').style.color = '';
        card.querySelectorAll('.option-btn').forEach(b => b.className = 'option-btn');
      });
      updateStats();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function jumpNext() {
      const first = Array.from(grid.children).find(c => c.dataset.status === 'unanswered' && !c.classList.contains('hidden'));
      if (first) {
        first.scrollIntoView({ behavior: 'smooth', block: 'center' });
        first.style.transform = 'scale(1.05)';
        setTimeout(() => first.style.transform = '', 500);
      }
    }

    function clearFilters() {
      els.search.value = '';
      els.status.value = 'all';
      els.province.value = 'all';
      filterGrid();
      updateStats();
    }

    function renderOverview() {
      els.list.innerHTML = '';
      state.forEach((s, i) => {
        const btn = document.createElement('div');
        btn.className = `grid-item ${s.status}`;
        btn.textContent = i + 1;
        btn.onclick = () => {
          els.modal.style.display = 'none';
          grid.children[i].scrollIntoView({ behavior: 'smooth', block: 'center' });
        };
        els.list.appendChild(btn);
      });
    }

    // Start
    init();
  </script>
</body>

</html>